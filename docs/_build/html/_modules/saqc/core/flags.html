
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>saqc.core.flags &#8212; SaQC 2.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="../../../_static/SaQCLogoSmall.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SaQC 2.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">saqc.core.flags</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for saqc.core.flags</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># SPDX-FileCopyrightText: 2021 Helmholtz-Zentrum f√ºr Umweltforschung GmbH - UFZ</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: GPL-3.0-or-later</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">DefaultDict</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">dios</span>
<span class="kn">from</span> <span class="nn">saqc.core.history</span> <span class="kn">import</span> <span class="n">History</span>

<span class="n">_VAL</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">History</span><span class="p">]</span>
<span class="n">DictLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">dios</span><span class="o">.</span><span class="n">DictOfSeries</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VAL</span><span class="p">],</span>
    <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VAL</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">_Field</span> <span class="o">=</span> <span class="nb">str</span>
<span class="n">SelectT</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">_Field</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">_Field</span><span class="p">],</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="n">_Field</span><span class="p">],</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="n">_Field</span><span class="p">],</span>
<span class="p">]</span>
<span class="n">ValueT</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_HistAccess</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Flags</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">History</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">History</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">History</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Not a History&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_validateHistForFlags</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


<div class="viewcode-block" id="Flags"><a class="viewcode-back" href="../../../_api/saqc.core.Flags.html#saqc.Flags">[docs]</a><span class="k">class</span> <span class="nc">Flags</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SaQC&#39;s flags container.</span>

<span class="sd">    This container class holds the quality flags associated with the data. It hold key-value pairs, where</span>
<span class="sd">    the key is the name of the column and the value is a ``pandas.Series`` of flags. The index of the series</span>
<span class="sd">    and the key-value pair can be assumed to be immutable, which means, only the *values* of the series can</span>
<span class="sd">    be change, once the series exist.</span>
<span class="sd">    In other words: **an existing column can not be overwritten by a column with a different index.**</span>

<span class="sd">    The flags can be accessed via ``__getitem__`` and ``__setitem__``, in real life known as the `[]`-operator.</span>

<span class="sd">    For the curious:</span>
<span class="sd">        Under the hood, the series are stored in a `history`, which allows the advanced user to retrieve all flags</span>
<span class="sd">        once was set in this object, but in the most cases this is irrelevant. For simplicity one can safely assume,</span>
<span class="sd">        that this class works just stores the flag-series one sets.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    initFlagsLike : create a Flags instance, with same dimensions as a reference object.</span>
<span class="sd">    History : class that actually store the flags</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    We create an empty instance, by calling ``Flags`` without any arguments and then add a column to it.</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; from saqc.constants import UNFLAGGED, BAD, DOUBTFUL</span>
<span class="sd">       &gt;&gt;&gt; flags = saqc.Flags()</span>
<span class="sd">       &gt;&gt;&gt; flags</span>
<span class="sd">       Empty Flags</span>
<span class="sd">       Columns: []</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[&#39;v0&#39;] = pd.Series([BAD,BAD,UNFLAGGED], dtype=float)</span>
<span class="sd">       &gt;&gt;&gt; flags # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">             v0 |</span>
<span class="sd">       ======== |</span>
<span class="sd">       0  255.0 |</span>
<span class="sd">       1  255.0 |</span>
<span class="sd">       2   -inf |</span>
<span class="sd">       &lt;BLANKLINE&gt;</span>

<span class="sd">    Once the column exist, we cannot overwrite it anymore, with a different series.</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[&#39;v0&#39;] = pd.Series([666.], dtype=float) # doctest:+ELLIPSIS</span>
<span class="sd">       Traceback (most recent call last):</span>
<span class="sd">         ...</span>
<span class="sd">       ValueError: Index does not match</span>


<span class="sd">    But if we pass a series, which index match it will work,</span>
<span class="sd">    because the series now is interpreted as value-to-set.</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[&#39;v0&#39;] = pd.Series([DOUBTFUL,np.nan,DOUBTFUL], dtype=float)</span>
<span class="sd">       &gt;&gt;&gt; flags # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">             v0 |</span>
<span class="sd">       ======== |</span>
<span class="sd">       0   25.0 |</span>
<span class="sd">       1  255.0 |</span>
<span class="sd">       2   25.0 |</span>
<span class="sd">       &lt;BLANKLINE&gt;</span>

<span class="sd">    As we see above, the column now holds a combination from the values from the</span>
<span class="sd">    first and the second set. This is, because ``numpy.nan`` was used.</span>
<span class="sd">    We can inspect all the updates that was</span>
<span class="sd">    made by looking in the history.</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[&#39;v0&#39;] = pd.Series([DOUBTFUL, np.nan, DOUBTFUL], dtype=float)</span>
<span class="sd">       &gt;&gt;&gt; flags.history[&#39;v0&#39;] # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">             0     1     2</span>
<span class="sd">       0  255.0  25.0  25.0</span>
<span class="sd">       1  255.0   nan   nan</span>
<span class="sd">       2   -inf  25.0  25.0</span>


<span class="sd">    As we see now, the second call sets ``25.0`` and shadows (represented by the parentheses) ``(255.0)`` in the</span>
<span class="sd">    first row and ``(-inf)`` in the last, but in the second row ``255.0`` still is valid, because it was</span>
<span class="sd">    `not touched` by the set.</span>

<span class="sd">    It is also possible to set values by a mask, which can be interpreted as condidional setting.</span>
<span class="sd">    Imagine we want to `reset` all flags to ``0.`` if the existing flags are lower that ``255.``.</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; mask = flags[&#39;v0&#39;] &lt; BAD</span>
<span class="sd">       &gt;&gt;&gt; mask # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">       0     True</span>
<span class="sd">       1    False</span>
<span class="sd">       2     True</span>
<span class="sd">       Name: 2, dtype: bool</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[mask, &#39;v0&#39;] = 0</span>
<span class="sd">       &gt;&gt;&gt; flags # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">             v0 |</span>
<span class="sd">       ======== |</span>
<span class="sd">       0    0.0 |</span>
<span class="sd">       1  255.0 |</span>
<span class="sd">       2    0.0 |</span>
<span class="sd">       &lt;BLANKLINE&gt;</span>

<span class="sd">    The objects you can pass as a row selector (``flags[rows, column]``) are:</span>

<span class="sd">    - boolen arraylike, with or without index. Must have same length than the undeliing series.</span>
<span class="sd">    - slices working on the index</span>
<span class="sd">    - ``pd.Index``, which must be a subset of the existing index</span>

<span class="sd">    For example, to set `all` values to a scalar value, use a Null-slice:</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags[:, &#39;v0&#39;] = 99.0</span>
<span class="sd">       &gt;&gt;&gt; flags # doctest:+NORMALIZE_WHITESPACE</span>
<span class="sd">            v0 |</span>
<span class="sd">       ======= |</span>
<span class="sd">       0  99.0 |</span>
<span class="sd">       1  99.0 |</span>
<span class="sd">       2  99.0 |</span>
<span class="sd">       &lt;BLANKLINE&gt;</span>


<span class="sd">    After all calls presented here, the history looks like this:</span>

<span class="sd">    .. doctest:: exampleFlags</span>

<span class="sd">       &gt;&gt;&gt; flags.history[&#39;v0&#39;]</span>
<span class="sd">             0     1     2    3     4</span>
<span class="sd">       0  255.0  25.0  25.0  0.0  99.0</span>
<span class="sd">       1  255.0   nan   nan  nan  99.0</span>
<span class="sd">       2   -inf  25.0  25.0  0.0  99.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">raw_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">DictLike</span><span class="p">,</span> <span class="n">Flags</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="n">raw_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">Flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initFromRaw</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_initFromRaw</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">History</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        init from dict-like: keys are flag column, values become</span>
<span class="sd">        initial columns of history(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;column names must be string&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;raw_data must not have duplicate keys&quot;</span><span class="p">)</span>

            <span class="c1"># a passed History is not altered. So if the passed History</span>
            <span class="c1"># does not fit for Flags, we fail hard.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">History</span><span class="p">):</span>
                <span class="n">Flags</span><span class="o">.</span><span class="n">_validateHistForFlags</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;cannot init from &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; of &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)</span>

            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">History</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validateHistForFlags</span><span class="p">(</span><span class="n">history</span><span class="p">:</span> <span class="n">History</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">history</span>

        <span class="n">errm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;History &quot;</span>
        <span class="k">if</span> <span class="n">colname</span><span class="p">:</span>
            <span class="n">errm</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;of column </span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2"> &quot;</span>

        <span class="c1"># this ensures that the mask does not shadow UNFLAGGED with a NaN.</span>
        <span class="k">if</span> <span class="n">history</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">hasnans</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errm</span> <span class="o">+</span> <span class="s2">&quot;is not valid (result of max() contains NaNs)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">history</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Flags&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># meta data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Column index of the flags container</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        columns: pd.Index</span>
<span class="sd">            The columns index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@columns</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set new columns names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : pd.Index</span>
<span class="sd">            New column names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">is_unique</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_string_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value must be pd.Index, with unique indices of type str&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;index must match current index in length&quot;</span><span class="p">)</span>

        <span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">_data</span><span class="p">[</span><span class="n">new</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">old</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if flags has no columns.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            ``True`` if the container has no columns, otherwise ``False``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># item access</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">SelectT</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueT</span><span class="p">):</span>
        <span class="c1"># force-KW is only internally available</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s2">&quot;a single &#39;column&#39; or a tuple of &#39;mask, column&#39; must be passt&quot;</span>
                <span class="p">)</span>
            <span class="n">mask</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

            <span class="n">tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># make a mask from an index, because it seems</span>
            <span class="c1"># that passing an index is a very common workflow</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># raises (correct) KeyError</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_list_like</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
                <span class="n">tmp</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;bad mask. cannot use mask of length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="si">}</span><span class="s2"> on &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;data of length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">tmp</span>

        <span class="c1"># technically it would be possible to select a field and set</span>
        <span class="c1"># the entire column to a scalar flag value (float), but it has</span>
        <span class="c1"># a high potential, that this is not intended by the user.</span>
        <span class="c1"># if desired use ``flags[:, field] = flag``</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;expected a value of type &#39;pd.Series&#39;, &quot;</span>
                <span class="s2">&quot;if a scalar should be set, please use &#39;flags[:, field] = flag&#39;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">History</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="Flags.drop"><a class="viewcode-back" href="../../../_api/saqc.core.Flags.html#saqc.Flags.drop">[docs]</a>    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a flags column.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            column name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flags object with dropped column, not a copy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># accessor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_HistAccess</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accessor for the flags history.</span>

<span class="sd">        Access via ``flags.history[&#39;var&#39;]``.</span>
<span class="sd">        To set a new history use ``flags.history[&#39;var&#39;] = value``.</span>
<span class="sd">        The passed value must be a instance of History or must be convertible to a</span>
<span class="sd">        history.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        history : History</span>
<span class="sd">            Accessor for the flags history</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        saqc.core.History : History storage class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_HistAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># copy</span>

<div class="viewcode-block" id="Flags.copy"><a class="viewcode-back" href="../../../_api/saqc.core.Flags.html#saqc.Flags.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the flags container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deep : bool, default True</span>
<span class="sd">            If False, a new reference to the Flags container is returned,</span>
<span class="sd">            otherwise the underlying data is also copied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        copy of flags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">h</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">new</span></div>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        memo, default None</span>
<span class="sd">            Standard signature. Unused</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># transformation and representation</span>

<div class="viewcode-block" id="Flags.toDios"><a class="viewcode-back" href="../../../_api/saqc.core.Flags.html#saqc.Flags.toDios">[docs]</a>    <span class="k">def</span> <span class="nf">toDios</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dios</span><span class="o">.</span><span class="n">DictOfSeries</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform the flags container to a ``dios.DictOfSeries``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dios.DictOfSeries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">dios</span><span class="o">.</span><span class="n">DictOfSeries</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">di</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">di</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Flags.toFrame"><a class="viewcode-back" href="../../../_api/saqc.core.Flags.html#saqc.Flags.toFrame">[docs]</a>    <span class="k">def</span> <span class="nf">toFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform the flags container to a ``pd.DataFrame``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toDios</span><span class="p">()</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toDios</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;DictOfSeries&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="initFlagsLike"><a class="viewcode-back" href="../../../_api/saqc.core.initFlagsLike.html#saqc.initFlagsLike">[docs]</a><span class="k">def</span> <span class="nf">initFlagsLike</span><span class="p">(</span>
    <span class="n">reference</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">DictLike</span><span class="p">,</span> <span class="n">Flags</span><span class="p">],</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flags</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create empty Flags, from an reference data structure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reference : pd.DataFrame, pd.Series, dios.DictOfSeries, dict of pd.Series</span>
<span class="sd">        The reference structure to initialize for.</span>

<span class="sd">    name : str, default None</span>
<span class="sd">        Only respected if `reference` is of type ``pd.Series``.</span>
<span class="sd">        The column name that is used for the Flags. If ``None``</span>
<span class="sd">        the name of the series itself is taken, if it is unset,</span>
<span class="sd">        a ValueError is raised.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implementation detail:</span>

<span class="sd">    The resulting Flags has not necessarily the exact same (inner) dimensions as the reference.</span>
<span class="sd">    This may happen, if the passed structure already holds History objects. Those are</span>
<span class="sd">    reduced 1D-DataFrame (1-column-History). Nevertheless the returned flags are perfectly suitable</span>
<span class="sd">    to be used in SaQC as flags container along with the passed reference structure (data).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    flags: Flags</span>
<span class="sd">        a flags object,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">Flags</span><span class="p">):</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;either the passed pd.Series must be named or a name must be passed&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be str not &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reference</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cannot use &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; as a column name, currently only string keys are allowed&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;reference must not have duplicate column names&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">History</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;items in reference must be of type pd.Series&quot;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">History</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Flags</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/SaQCLogo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../../../index.html">Table of Contents</a></h3>
    <ul>
<li class="toctree-l1"><a class="reference external" href="https://git.ufz.de/rdm-software/saqc">Repository</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/InstallationGuide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/TutorialAPI.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/TutorialCLI.html">Command Line Application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cookbooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbooks/DataRegularisation.html">Data Regularisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbooks/OutlierDetection.html">Outlier Detection and Flagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbooks/MultivariateFlagging.html">Multivariate Flagging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/ConfigurationFiles.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/GenericFunctions.html">Generic Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/GlobalKeywords.html">Global Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/Customizations.html">Customizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/SourceTarget.html">Assigning results to new variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/FlaggingTranslation.html">Flags, History and Translations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SaQC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/SaQC.html">Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/SaQCCore.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/SaQCFunctions.html">Test Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/SaQCTranslation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/SaQCConstants.html">Constants</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../howtodoc/HowToDoc.html">Documentation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/WritingFunctions.html">Writing Functions</a></li>
</ul>

  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SaQC 2.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">saqc.core.flags</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Bert Palm, David Sch√§fer, Peter L√ºnenschlo√ü, Florian Gransee.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>